<html> 
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/test/ace.js"></script>
    <script src="http://www.skulpt.org/js/skulpt.min.js" type="text/javascript"></script> 
    <script src="http://www.skulpt.org/js/skulpt-stdlib.js" type="text/javascript"></script>
    <script src="https://code.createjs.com/1.0.0/tweenjs.min.js"></script>
    <script src="https://env3d.github.io/env3d-js/dist/js/inflate.min.js"></script>
    <script src="https://env3d.github.io/env3d-js/dist/js/env3d.js"></script>
    <style>
      #editor {
	  height: 300px;
      }
    </style>
  </head> 

  <body> 

    <script type="text/javascript">
      var env = null;
      var editor = null; 
      
      // output functions are configurable.  This one just appends some text
      // to a pre element.
      function outf(text) { 
	var mypre = document.getElementById("output"); 
	mypre.innerHTML = mypre.innerHTML + text; 
      } 
      function builtinRead(x) {
	if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
          throw "File not found: '" + x + "'";
	return Sk.builtinFiles["files"][x];
      }

      // Here's everything you need to run a python program in skulpt
      // grab the code from your textarea
      // get a reference to your pre element for output
      // configure the output function
      // call Sk.importMainWithBody()
      function runit() { 
	var prog = editor.getValue();
	var mypre = document.getElementById("output"); 
	mypre.innerHTML = '';
	
	Sk.pre = "output";
	Sk.configure({output:outf, read:builtinRead});
	
	var myPromise = Sk.misceval.asyncToPromise(function() {
	  return Sk.importMainWithBody("<stdin>", false, prog, true);
	});
	myPromise.then(function(mod) {
	  console.log('success');
	},function(err) {
	  console.log(err.toString());
	});

      }

      createjs.Ticker.setFPS(30);

      window.addEventListener('load', () => {
	editor = ace.edit("editor");
	editor.setTheme("ace/theme/monokai");
	editor.session.setMode("ace/mode/python");
	

	
	fetch('./env3d.js')
	  .then( res => res.text() )
	  .then( env3d => {
	    console.log('injecting env3d', env3d);
	    Sk.builtinFiles["files"]['src/lib/env3d.js'] = env3d;	    
	  });
	
	env3d.Env.baseAssetsUrl = "https://env3d.github.io/env3d-js/dist/";
	env = new env3d.Env();
	env.setCameraXYZ(5,5,25);
	env.start();

      });
      </script> 

    <h3>Try This</h3> 
    <div id="editor">
print "Hello World"
import env3d

def object1():
    myobj = env3d.GameObject()
    myobj.set_texture('textures/doty.png')
    for i in range(5):
        myobj.move_to(5,5,5)
        myobj.move_to(9,5,5)
    return myobj

def object2():
    myobj2 = env3d.GameObject()
    myobj2.move_to(5,1,5)
    myobj2.move_to(9,1,5)
    myobj2.set_texture('textures/doty.png')
    return myobj2

object2().on_complete(object1)
    </div><br /> 
    <button type="button" onclick="runit()">Run</button> 

    <pre id="output" ></pre> 
    <div id="env3d" style="width: 300px; height: 300px"></div>


  </body> 

</html> 
